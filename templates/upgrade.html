{% extends "layout.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow-lg border-primary mb-5">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0"><i class="fas fa-star me-2"></i>Upgrade to Premium</h3>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h4>Premium Membership Benefits</h4>
                        <ul class="list-unstyled mt-3">
                            {% for feature in plan.features %}
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i> {{ feature }}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="col-md-6 border-start">
                        <div class="text-center mb-4">
                            <h4>Premium Membership</h4>
                            <div class="pricing-box py-3">
                                <span class="display-4">${{ "%.2f"|format(plan.price) }}</span>
                                <span class="text-muted">/month</span>
                            </div>
                        </div>
                        
                        <div class="payment-options">
                            <!-- This section will be populated with Stripe when API key is available -->
                            <form id="payment-form" class="mt-4">
                                <div id="payment-message" class="alert alert-info mb-4">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Demo Mode: Click the button below to simulate a successful payment.
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <button id="submit-button" type="submit" class="btn btn-lg btn-primary">
                                        <i class="fas fa-lock me-2"></i>Secure Checkout
                                    </button>
                                </div>
                                
                                <div class="text-center mt-3">
                                    <img src="https://cdn.jsdelivr.net/gh/stripe/credit-card-logos@master/visa-logo.svg" height="30" alt="Visa" class="me-2">
                                    <img src="https://cdn.jsdelivr.net/gh/stripe/credit-card-logos@master/mastercard-logo.svg" height="30" alt="Mastercard" class="me-2">
                                    <img src="https://cdn.jsdelivr.net/gh/stripe/credit-card-logos@master/amex-logo.svg" height="30" alt="American Express" class="me-2">
                                    <img src="https://cdn.jsdelivr.net/gh/stripe/credit-card-logos@master/discover-logo.svg" height="30" alt="Discover">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <hr>
                
                <div class="row mt-4">
                    <div class="col-md-12">
                        <h5>Frequently Asked Questions</h5>
                        <div class="accordion mt-3" id="faqAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqOne">
                                        When will I be charged?
                                    </button>
                                </h2>
                                <div id="faqOne" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        Your card will be charged immediately upon subscribing. Subsequent charges will occur monthly on the same date.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqTwo">
                                        Can I cancel my subscription?
                                    </button>
                                </h2>
                                <div id="faqTwo" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        Yes, you can cancel your subscription anytime from your profile page. Your Premium benefits will continue until the end of your current billing period.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card-footer text-center">
                <small class="text-muted">Secure payment processing by <i class="fab fa-stripe"></i> Stripe</small>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const paymentForm = document.getElementById('payment-form');
    const submitButton = document.getElementById('submit-button');
    const paymentMessage = document.getElementById('payment-message');
    
    paymentForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Disable the submit button and show processing message
        submitButton.disabled = true;
        submitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Processing...';
        
        // Simulate payment processing (for demo purposes)
        setTimeout(function() {
            // Send the payment to the server
            fetch('/upgrade', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify({
                    payment_method: 'demo',
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Redirect to profile page on success
                    paymentMessage.className = 'alert alert-success mb-4';
                    paymentMessage.innerHTML = '<i class="fas fa-check-circle me-2"></i>Payment successful! Redirecting to your profile...';
                    
                    setTimeout(function() {
                        window.location.href = data.redirect;
                    }, 1500);
                } else {
                    // Show error message
                    paymentMessage.className = 'alert alert-danger mb-4';
                    paymentMessage.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i>' + data.error;
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<i class="fas fa-lock me-2"></i>Secure Checkout';
                }
            })
            .catch(error => {
                // Show generic error message
                paymentMessage.className = 'alert alert-danger mb-4';
                paymentMessage.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i>An error occurred during payment processing. Please try again.';
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-lock me-2"></i>Secure Checkout';
                console.error('Error:', error);
            });
        }, 1500); // Simulated processing time
    });
});
</script>
{% endblock %}